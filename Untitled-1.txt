using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;
using System;
using System.Threading;
using System.Collections;

public class Script1 : MonoBehaviour
{
    public Text scoreText;
    public Button[] upgradebuttons;
    public GameObject upgradepan;
    public float[] PrayTime;
    private int score;
    private int bonus = 1;
    public int priestscount, priestbonus = 1;

    public GameObject nempan;
    public int[] upgradeCosts;
    public int[] upgradeBonuses;
    public Text[] upgradebttnstext;


    private void Start()
    {
        StartCoroutine(Bonuspersec());
    }
    private void Update()
    {
        scoreText.text = score + "$";
    }
    public void upgrade()                                                       // кнопка апгрейд знизу зправа
    {
        upgradepan.SetActive(!upgradepan.activeSelf);
    }
    public void upgradepanplusbonus(int index)                                  // панелька яка відкривається кнопкою апгрейд
    {
        if (score >= upgradeCosts[index])
        {
            bonus += upgradeBonuses[index];
            score -= upgradeCosts[index];
            upgradeCosts[index] *= 2;
            upgradebttnstext[index].text = "Lvlup\n" + upgradeCosts[index] + "$";
        }
        else
        {
            StartCoroutine(nem(nempan));                                        // запускає каротіну для панельки з надписом що не достатньо коштів
        }


    }

    public void Hirepriest(int index)                                             // метод для найму прістів
    {
        if (score >= upgradeCosts[index])
        {
            priestscount++;
            score -= upgradeCosts[index];
            upgradeCosts[index] *= 2;
            upgradebttnstext[index].text = "Hire priest\n" + upgradeCosts[index] + "$";
        }
        else
        {
            StartCoroutine(nem(nempan));                                        // запускає каротіну для панельки з надписом що не достатньо коштів
        }
    }

    public void startPraytimer(int index)                                           // старт молитви
    {

        int cost = 3 * priestscount;
        if (priestscount > 0)
        upgradebttnstext[2].text = "Pray\n" + cost + "$";
        
        if (score >= cost)
        {
            StartCoroutine(PrayTimer(PrayTime[index], index));
            score -= cost;
        }
        else
        {
            StartCoroutine(nem(nempan));                                        // запускає каротіну для панельки з надписом що не достатньо коштів
        }

    }

    IEnumerator Bonuspersec()                                                   // щосекунди добавляє бонус
    {
        while (true)
        {
            score += (priestscount * priestbonus);
            yield return new WaitForSeconds(1);
        }

    }

    IEnumerator PrayTimer(float timer, int index)
    {
        upgradebuttons[index].interactable = false;
        if (index == 0 && priestscount > 0)
        {
            priestbonus *= 3;
            yield return new WaitForSeconds(timer);
            priestbonus /= 3;
        }

        upgradebuttons[index].interactable = true;
    }

    IEnumerator nem(GameObject nempan)
    {

        nempan.SetActive(true);
        yield return new WaitForSeconds(1);
        nempan.SetActive(false);

    }
    public void OnClick()
    {
        score += bonus;

    }


}
